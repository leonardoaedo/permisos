{% extends "edt/base.html" %}
{% load staticfiles %}
{% block contenido %}

<link rel="stylesheet" type="text/css" href="/static/css/normalize.css" />
<link rel="stylesheet" type="text/css" href="/static/css/demo.css" />
<link rel="stylesheet" type="text/css" href="/static/css/component.css" />
<div class='form-group'>
    <div class="row">                 
        <div class="col-lg-8">    
                                                                 
        </div>  
        <div class="col-lg-1">                            
            <a href="/estadisticapermisosEXCEL?{{query_string}}" class="btn btn-success btn-block" target="_blank">
                <img src="/static/img/xls.png" width="35" height="35">
            </a>                          
        </div>
        
        <div class="col-lg-1">                            
            <a href="/estadisticapermisosPDF?{{query_string}}" class="btn btn-success btn-block" target="_blank">
                <img src="/static/img/pdf.png" width="35" height="35">
            </a>                          
        </div>                                                    
    </div>
</div>

<div class="tituloinforme"><h1>Permisos</h1></div>
<div class="fechasfiltro" ><h4>{% if start %} Periodo comprendido entre {{inicio|date:"d/m/Y"}} y {{termino|date:"d/m/Y"}} {% endif %}</h4></div>
<div>
  <div class="filtros">
  <form id="horas" class="form-horizontal" method="get">
  <fieldset>
    <legend>Filtros</legend>
  <ul>
    <li>
      <label class="label label-primary" > Funcionario</label>
      <select name="persona" >
        <option value="0">Seleccione Funcionario</option>
        {% for persona in usuarios_filtro %}  
        <option value="{{persona.id}}" {% if persona.usuario_activo %}selected{% endif %}> {{persona}}  <!--{{persona.usuario_activo}}--> </option>
        {% endfor %}
      </select>
    </li>
    <li>
      <label class="label label-primary" >Estamento</label>
      <select name="estamento">
        <option value="0">Seleccione Estamento</option>
        {% for estament in estamento_filtro %}
        <option value="{{estament.id}}" {% if estament.estamento_activo %}selected{% endif %}> {{estament}}<!-- -{{estament.estamento_activo}} --> </option>
        {% endfor %}
      </select>
    </li>
    <li>
      <label class="label label-primary">Horas</label>
        <select name="thora">
          <option value ="0" >Seleccione Opci칩n</option>
          <option value="Seleccione Opci칩n" {% if thora %}selected {% endif %}>{{thora}}</option>
          <option value ="Horas por Descontar">Horas por Descontar</option>
          <option value ="Horas por Devolver">Horas por Devolver</option>
          <option value="Horas Descontadas">Horas Descontadas</option>
          <option value="Horas Devueltas">Horas Devueltas</option>

        </select>

    </li>
    <li>
      <label class="label label-primary" >Rango de fechas</label>
      <input id="periodpickerstart" type="text" name="start" value="{{start}}"/>
      <input id="periodpickerend" type="text" name="end" value="{{end}}"/>      
    </li>

    <li class="botfiltro">
      <input class=" btn btn-success" type="submit" value="Filtrar" id="filtrar" name="filtrar" />
      <input class=" btn btn-danger" type="submit" value="Quitar Filtros" id="limpiar" name="limpiar" />

    </li>
  </ul>
  </fieldset> 
  </form>
 </div>
{% if permisos %}

  <table class="informe"> 
            <thead>
                <tr>
                  
                  <th>Correlativo</th>
                  <th>Solicitante</th>
                  <th>Rut</th>
                  <th>Funcion/Cargo</th>
                  <th>Fecha de solicitud</th>
                  <th>Tipo</th>
                  <th>Dia del permiso</th>
                  <th>Motivo</th>
                  <th>Comentario</th>                  
                  <th>Horas</th>
                  <th>Bloques</th>
                  <th>Resoluci칩n</th>
                  <th>Devuelve horas</th>
                  <th>Con o sin goce de sueldo</th>
                  <th>Reemplazante</th>
                  <th>Archivo adjunto</th>
                </tr>
              </thead>
            <tbody>   
  {% for permiso in permisos %}
  			     
            <tr {% if permiso.estado.id == 6 %} class="anulado" {% elif permiso.ultimaResolucion %} {% else %} class="sinrevisar" {% endif %}  >
                <td class="correlativo centrado">{{permiso.id}}</td>
                <td >{{permiso.usuario.apellido1}} {{permiso.usuario.apellido2}} {{permiso.usuario.nombre}}</td>                
                <td >{{permiso.usuario.rut}}-{{permiso.usuario.dv}}</td>
                <td >{{permiso.usuario.cargo}}</td>
                <td class="centrado">{{permiso.fecha_creacion|date:"d-m-Y"}}</td>
                <td >{{permiso.tipo}}</td>
                <td >{{permiso.primerEvento.numero_evento.start|date:"d-m-Y"}}</td>
                <td >{{permiso.motivo}}</td>           
                <td class="ComentarioInforme">{{permiso.comentario}}</td>
                <td class="centrado">{% if permiso.usuario.cargo.id != 19 %} {{permiso.horas_solicitadas}} {% else %} - {% endif %}</td>
                <td class="centrado ">{% if permiso.usuario.cargo.id = 19 %} {{permiso.horas_solicitadas}} {% else %} -  {% endif %}</td>
                <td>{% if permiso.estado.id == 6 %} Anulado {% elif permiso.ultimaResolucion %}{{permiso.ultimaResolucion.get_respuesta_display}} {% else %} Sin revisar{% endif %} </td>
                <td class="centrado">{{ permiso.get_devuelve_horas_display }}</td>
                <td >{{ permiso.get_sueldo_display }}</td>                
                <td >{{permiso.reemplazante}}</td>
                <td class="documentoadjunto centrado">{% if permiso.documento_adjunto.name %} <a target="_blank" href="/media/{{permiso.documento_adjunto}}">Ver Documento</a> {% else %} Sin documento adjunto{% endif %} </td>
                              
            </tr>   

           

  {% empty %}
      <tr>
        <td class="list-group-item">En este momento no hay ningun elemento para mostrar</td>
      </tr>
        {% endfor %}           
        </tbody>    
    </table>
 
  {# .... **Comienzo de la paginacion** .... #}
    {% if is_paginated %}
        <div class="pagination">
            <span class="page-links">
                {% if page_obj.has_previous %}
                    <a href="?page={{ page_obj.previous_page_number }}"><img width="25px" height="25px" src='/static/img/back.png' alt='Volver'/></a>
                {% endif %}
                <span class="page-current">
                    P치gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}.
                </span>
                {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}"><img width="25px" height="25px" src='/static/img/next.png' alt='Siguiente'/></a>
                {% endif %}
            </span>
        </div>
    {% endif %}

{% endif %}

</div>


<script>

jQuery('#periodpickerstart').periodpicker({
 end: '#periodpickerend', 
 lang :'es',
 resizeButton: false, // deny resize picker
 fullsizeButton: false,
 fullsizeOnDblClick: false,
 clearButtonInButton: true,
 timepicker: true, // use timepicker
 timepickerOptions: {
    hours: true,
    minutes: true,
    seconds: false,
    ampm: true
  },
 formatDateTime: 'YYYY-MM-DD HH:mm:ss',
 cells: [1, 3],

});
</script>    
{% endblock  %}